"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-pdf-viewer/core");function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var i=n(e),r=function(e){var n=e.page,r=e.pageHeight,a=e.pageWidth,u=e.rotation,c=e.thumbnailHeight,o=e.thumbnailWidth,s=i.useRef(),g=i.useState(""),l=g[0],p=g[1];return i.useEffect((function(){var e=s.current;e&&e.cancel();var t=document.createElement("canvas"),i=t.getContext("2d",{alpha:!1}),c=o,g=c/(a/r),l=c/a;t.height=g,t.width=c,t.style.height=g+"px",t.style.width=c+"px";var h=n.getViewport({rotation:u,scale:l});s.current=n.render({canvasContext:i,viewport:h}),s.current.promise.then((function(){return p(t.toDataURL())}),(function(){}))}),[u]),l?i.createElement("img",{src:l,height:c+"px",width:o+"px"}):i.createElement(t.Spinner,null)},a=function(e){var n=e.doc,a=e.isActive,u=e.pageHeight,c=e.pageIndex,o=e.pageWidth,s=e.rotation,g=e.onActive,l=i.useState({height:u,isCalculated:!1,page:null,viewportRotation:0,width:o}),p=l[0],h=l[1],d=i.useRef({isVisible:!1,ratio:0}),f=p.isCalculated,b=p.page,m=p.height,v=p.width,E=v/m,w=Math.abs(s)%180==0,P=w?100:100/E,H=w?100/E:100;i.useLayoutEffect((function(){if(a){var e=x.current,t=d.current;(!t.isVisible||t.ratio<1)&&g(e)}}),[a]);var _=(s+p.viewportRotation)%360,x=t.useIntersectionObserver({onVisibilityChanged:function(e){d.current=e,e.isVisible&&!f&&n.getPage(c+1).then((function(e){var t=e.getViewport({scale:1});h({height:t.height,isCalculated:!0,page:e,viewportRotation:t.rotation,width:t.width})}))}});return i.createElement("div",{className:"rpv-thumbnail__container",ref:x,style:{height:H+"px",width:P+"px"}},b?i.createElement(r,{page:b,pageHeight:w?m:v,pageWidth:w?v:m,rotation:_,thumbnailHeight:H,thumbnailWidth:P}):i.createElement(t.Spinner,null))},u=function(e){var t=e.currentPage,n=e.doc,r=e.pageHeight,u=e.pageWidth,c=e.rotation,o=e.onJumpToPage,s=n.numPages,g=i.useRef(null),l=function(e){var t=g.current;t&&function(e,t){var n=e.getBoundingClientRect().top-t.getBoundingClientRect().top,i=e.clientHeight,r=t.clientHeight;n<0?t.scrollTop+=n:n+i<=r||(t.scrollTop+=n+i-r)}(e.parentElement,t)};return i.createElement("div",{ref:g,className:"rpv-thumbnail__list"},Array(s).fill(0).map((function(e,s){return i.createElement("div",{className:(g={"rpv-thumbnail__item":!0,"rpv-thumbnail__item--selected":t===s},p=[],Object.keys(g).forEach((function(e){e&&g[e]&&p.push(e)})),p.join(" ")),key:"thumbnail-"+s,onClick:function(){return o(s)}},i.createElement(a,{doc:n,isActive:t===s,pageHeight:r,pageIndex:s,pageWidth:u,rotation:c,onActive:l}));var g,p})))},c=function(e){var n=e.store,r=i.useState(n.get("doc")),a=r[0],c=r[1],o=i.useState(n.get("currentPage")||0),s=o[0],g=o[1],l=i.useState(n.get("pageHeight")||0),p=l[0],h=l[1],d=i.useState(n.get("pageWidth")||0),f=d[0],b=d[1],m=i.useState(n.get("rotation")||0),v=m[0],E=m[1],w=function(e){g(e)},P=function(e){c(e)},H=function(e){h(e)},_=function(e){b(e)},x=function(e){E(e)};return i.useEffect((function(){return n.subscribe("doc",P),n.subscribe("pageHeight",H),n.subscribe("pageWidth",_),n.subscribe("rotation",x),function(){n.unsubscribe("doc",P),n.unsubscribe("pageHeight",H),n.unsubscribe("pageWidth",_),n.unsubscribe("rotation",x)}}),[]),t.useIsomorphicLayoutEffect((function(){return n.subscribe("currentPage",w),function(){n.unsubscribe("currentPage",w)}}),[]),a?i.createElement(u,{currentPage:s,doc:a,pageHeight:p,pageWidth:f,rotation:v,onJumpToPage:function(e){var t=n.get("jumpToPage");t&&t(e)}}):i.createElement("div",{className:"rpv-thumbnail__loader"},i.createElement(t.Spinner,null))};exports.thumbnailPlugin=function(){var e=i.useMemo((function(){return t.createStore({})}),[]);return{install:function(t){e.update("jumpToPage",t.jumpToPage)},onDocumentLoad:function(t){e.update("doc",t.doc)},onViewerStateChange:function(t){return e.update("currentPage",t.pageIndex),e.update("pageHeight",t.pageHeight),e.update("pageWidth",t.pageWidth),t},Thumbnails:function(){return i.createElement(c,{store:e})}}};

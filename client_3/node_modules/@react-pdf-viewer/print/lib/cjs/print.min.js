"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-pdf-viewer/core"),n=require("react-dom");function r(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var a,o=r(e),i=function(){return o.createElement(t.Icon,{size:16},o.createElement("path",{d:"M7.5,19.499h9 M7.5,16.499h9 M5.5,16.5h-3c-1.103-0.003-1.997-0.897-2-2v-6c0.003-1.103,0.897-1.997,2-2h19\n                c1.103,0.003,1.997,0.897,2,2v6c-0.003,1.103-0.897,1.997-2,2h-3\n                M5.5,4.5v-4h9.586c0.265,0,0.52,0.105,0.707,0.293l2.414,2.414\n                C18.395,3.394,18.5,3.649,18.5,3.914V4.5\n                M18.5,22.5c0,0.552-0.448,1-1,1h-11c-0.552,0-1-0.448-1-1v-9h13V22.5z\n                M3.5,8.499\n                c0.552,0,1,0.448,1,1s-0.448,1-1,1s-1-0.448-1-1S2.948,8.499,3.5,8.499z\n                M14.5,0.499v4h4"}))},c=function(){return(c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},u={left:0,top:8},l=function(e){var n=e.onClick,r=o.useContext(t.LocalizationContext),a=r&&r.print?r.print.print:"Print";return o.createElement(t.Tooltip,{position:t.Position.BottomCenter,target:o.createElement(t.MinimalButton,{onClick:n},o.createElement(i,null)),content:function(){return a},offset:u})};!function(e){e.Inactive="Inactive",e.Preparing="Preparing",e.Cancelled="Cancelled",e.Ready="Ready"}(a||(a={}));var s=a,p=function(e){var t=e.children,n=e.store;return(t||function(e){return o.createElement(l,{onClick:e.onClick})})({onClick:function(){n.update("printStatus",s.Preparing)}})},d=function(e){var n=e.numLoadedPages,r=e.numPages,a=e.onCancel,i=o.useContext(t.LocalizationContext),c=Math.floor(100*n/r);return o.createElement("div",{className:"rpv-print__progress"},o.createElement("div",{className:"rpv-print__progress-body"},o.createElement("div",{className:"rpv-print__progress-message"},i&&i.print?i.print.preparingDocument:"Preparing document ..."),o.createElement("div",{className:"rpv-print__progress-bar"},o.createElement(t.ProgressBar,{progress:c})),o.createElement(t.Button,{onClick:a},i&&i.print?i.print.cancel:"Cancel")))},m=function(e){var t=e.canvas,n=e.page,r=e.pageHeight,a=e.pageWidth,i=e.rotation,c=e.onLoad,u=o.useRef(),l=o.useState(""),s=l[0],p=l[1];return o.useEffect((function(){var e=u.current;e&&e.cancel();var o=150/72;t.height=Math.floor(r*o),t.width=Math.floor(a*o);var c=t.getContext("2d");c.save(),c.fillStyle="rgb(255, 255, 255)",c.fillRect(0,0,t.width,t.height),c.restore();var l=n.getViewport({rotation:i,scale:1});u.current=n.render({canvasContext:c,intent:"print",transform:[o,0,0,o,0,0],viewport:l}),u.current.promise.then((function(){"toBlob"in t?t.toBlob((function(e){p(URL.createObjectURL(e))})):p(t.toDataURL())}),(function(){}))}),[]),s&&o.createElement("div",{className:"rpv-print__page"},o.createElement("img",{src:s,onLoad:function(){return c()}}))},g=function(e){var t=e.canvas,n=e.doc,r=e.pageHeight,a=e.pageIndex,i=e.pageWidth,c=e.rotation,u=e.onLoad,l=o.useState({height:r,page:null,viewportRotation:0,width:i}),s=l[0],p=l[1],d=s.page,g=s.height,f=s.width,v=Math.abs(c)%180==0;o.useEffect((function(){n.getPage(a+1).then((function(e){var t=e.getViewport({scale:1});p({height:t.height,page:e,viewportRotation:t.rotation,width:t.width})}))}),[]);var h=(c+s.viewportRotation)%360;return d&&o.createElement(m,{canvas:t,page:d,pageHeight:v?g:f,pageWidth:v?f:g,rotation:h,onLoad:u})},f=function(e){var t=e.doc,r=e.numLoadedPages,a=e.pageHeight,i=e.pageWidth,c=e.printStatus,u=e.rotation,l=e.onCancel,p=e.onLoad,d=o.useMemo((function(){return document.createElement("canvas")}),[]),m=o.useMemo((function(){var e=document.createElement("div");return e.classList.add("rpv-print__zone"),document.body.appendChild(e),e}),[]);return o.useEffect((function(){c===s.Ready&&(document.documentElement.classList.add("rpv-print__html-printing"),document.body.classList.add("rpv-print__body-printing"),window.print());var e=function(){c===s.Ready&&(document.documentElement.classList.remove("rpv-print__html-printing"),document.body.classList.remove("rpv-print__body-printing"),m.parentElement&&m.parentElement.removeChild(m),d.height=0,d.width=0,document.removeEventListener("mousemove",e),l())};return document.addEventListener("mousemove",e),function(){return document.removeEventListener("mousemove",e)}}),[c]),n.createPortal(o.createElement(o.Fragment,null,Array(Math.min(r+1,t.numPages)).fill(0).map((function(e,n){return o.createElement(g,{key:n,canvas:d,doc:t,pageHeight:a,pageIndex:n,pageWidth:i,rotation:u,onLoad:p})})),o.createElement("style",{dangerouslySetInnerHTML:{__html:"@page { size: "+i+"pt "+a+"pt }"}})),m)},v=function(e){var t=e.doc,n=e.pageHeight,r=e.pageWidth,a=e.rotation,i=e.store,c=o.useState(s.Inactive),u=c[0],l=c[1],p=o.useState(0),m=p[0],g=p[1],v=function(){g(0),l(s.Inactive)},h=function(e){return l(e)};return o.useEffect((function(){return i.subscribe("printStatus",h),function(){i.unsubscribe("printStatus",h)}}),[]),o.createElement(o.Fragment,null,u===s.Preparing&&o.createElement(d,{numLoadedPages:m,numPages:t.numPages,onCancel:v}),(u===s.Preparing||u===s.Ready)&&m<=t.numPages&&o.createElement(f,{doc:t,numLoadedPages:m,pageHeight:n,pageWidth:r,printStatus:u,rotation:a,onCancel:v,onLoad:function(){var e=m+1;e<=t.numPages&&(g(e),e===t.numPages&&l(s.Ready))}}))},h=function(e){var n=e.onClick,r=o.useContext(t.LocalizationContext),a=r&&r.print?r.print.print:"Print";return o.createElement(t.MenuItem,{icon:o.createElement(i,null),onClick:n},a)},E=function(e){var t=e.containerRef,n=e.store,r=function(e){if(!e.shiftKey&&!e.altKey&&"p"===e.key&&("undefined"!=typeof window&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)?e.metaKey:e.ctrlKey)){var r=t.current;r&&document.activeElement&&document.activeElement.contains(r)&&(e.preventDefault(),n.update("printStatus",s.Preparing))}};return o.useEffect((function(){if(t.current)return document.addEventListener("keydown",r),function(){document.removeEventListener("keydown",r)}}),[t.current]),o.createElement(o.Fragment,null)};exports.PrintIcon=i,exports.printPlugin=function(e){var n=o.useMemo((function(){return Object.assign({},{enableShortcuts:!0},e)}),[]),r=o.useMemo((function(){return t.createStore({printStatus:s.Inactive})}),[]),a=function(e){return o.createElement(p,c({},e,{store:r}))};return{renderViewer:function(e){var t=e.slot,a={children:o.createElement(o.Fragment,null,n.enableShortcuts&&o.createElement(E,{containerRef:e.containerRef,store:r}),o.createElement(v,{doc:e.doc,pageHeight:e.pageHeight,pageWidth:e.pageWidth,rotation:e.rotation,store:r}),t.children)};return c(c({},t),a)},Print:a,PrintButton:function(){return o.createElement(a,null,(function(e){return o.createElement(l,c({},e))}))},PrintMenuItem:function(e){return o.createElement(a,null,(function(t){return o.createElement(h,{onClick:function(){t.onClick(),e.onClick()}})}))}}};
